# üèóÔ∏è QUARK PLATFORM - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò –ò –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ï–®–ï–ù–ò–Ø

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Single source of truth –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï–õ–¨–ó–Ø –∑–∞–±—ã–≤–∞—Ç—å –∏–ª–∏ –º–µ–Ω—è—Ç—å –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.

**–û–±–Ω–æ–≤–ª—è—Ç—å**: –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏.

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–û–í

### üö® –ü–µ—Ä–µ–¥ –ø—Ä–∞–≤–∫–æ–π quark-manager.sh

> **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ü–†–û–ß–ò–¢–ê–ô–¢–ï –≠–¢–û–¢ –î–û–ö–£–ú–ï–ù–¢ –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–î –õ–Æ–ë–´–ú –ò–ó–ú–ï–ù–ï–ù–ò–ï–ú `quark-manager.sh`**

**–ü—Ä–∏—á–∏–Ω–∞**: –°–∫—Ä–∏–ø—Ç `quark-manager.sh` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª–æ–º–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞–º–∏.

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å**:
1. ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ `/docs/quark-manager.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–∞
2. ‚úÖ –ò–∑—É—á–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `main()` - —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–±–ª–µ–º –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ (—Å–º. "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è")
4. ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é: `cp quark-manager.sh quark-manager.sh.backup`
5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
6. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ `/docs/quark-manager.md` –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã** (—É—á–∏—Ç–µ—Å—å –Ω–∞ –æ—à–∏–±–∫–∞—Ö –ø—Ä–æ—à–ª–æ–≥–æ):
- 2025-11-06: –ü–æ–ø—ã—Ç–∫–∞ —Ä–∞–∑–±–∏—Ç—å `main()` –Ω–∞ `parse_args()` –∏ `execute_command()` –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–∏–≤–µ–ª–∞ –∫ –ø–æ–ª–Ω–æ–π –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∞
- –†–µ—à–µ–Ω–∏–µ: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ git –∏—Å—Ç–æ—Ä–∏–∏

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –°–º. `/docs/quark-manager.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø—Ä–∞–≤–∏–ª –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

## üì¶ PACKAGE MANAGEMENT

### ‚úÖ pnpm Workspace (–ú–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)

**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–û  
**–í–µ—Ä—Å–∏—è**: pnpm 10.x  
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `pnpm-workspace.yaml`

```yaml
packages:
  - 'services/*'
  - 'infra/*'
  - 'tools/*'
```

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è **–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** `npm install` –∏–ª–∏ `yarn` - —Ç–æ–ª—å–∫–æ `pnpm`
- ‚ö†Ô∏è **–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ –∫–æ—Ä–Ω—è: `pnpm install`
- ‚ö†Ô∏è **Docker –æ–±—Ä–∞–∑—ã** –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å pnpm symlinks (—Å–º. —Ä–∞–∑–¥–µ–ª Docker)

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏—è**:
- –°–ª–æ–º–∞–µ—Ç—Å—è resolution –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É packages
- node_modules –±—É–¥—É—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è
- CI/CD pipeline —Å–ª–æ–º–∞–µ—Ç—Å—è

---

## üê≥ DOCKER & CONTAINERIZATION

### ‚ö†Ô∏è Docker Compose v2.30.3 (–û–ë–ù–û–í–õ–ï–ù–û)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –£–°–¢–ê–ù–û–í–õ–ï–ù  
**–ö–æ–º–∞–Ω–¥–∞**: `docker compose` (–±–µ–∑ –¥–µ—Ñ–∏—Å–∞)  
**–í–µ—Ä—Å–∏—è**: v2.30.3  
**BuildKit**: –í–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ**: 2025-11-04
```bash
# Docker Compose v2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ CLI plugin
~/.docker/cli-plugins/docker-compose

# –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
quark-manager.sh: docker-compose ‚Üí docker compose ‚úÖ
manual-build-auth.sh: docker-compose ‚Üí docker compose ‚úÖ
```

**BuildKit –≤–∫–ª—é—á—ë–Ω**:
```bash
export DOCKER_BUILDKIT=1
docker compose build <service>
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ v2**:
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π network stack
- ‚úÖ BuildKit –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (cache mounts, parallel layers)
- ‚úÖ –õ—É—á—à–µ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

---

### üèóÔ∏è Docker Build Strategy –¥–ª—è pnpm Workspace

**–û–ë–ù–û–í–õ–ï–ù–û**: 2025-11-04 - –ü—Ä–∏–º–µ–Ω–µ–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ì–ª–∞–≤–Ω–æ–≥–æ –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞

**–ö–†–ò–¢–ò–ß–ù–û**: pnpm —Å–æ–∑–¥–∞–µ—Ç symlinks, –∫–æ—Ç–æ—Ä—ã–µ –ª–æ–º–∞—é—Ç—Å—è –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–µ–∂–¥—É Docker layers!

**‚úÖ –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–´–ô –ü–û–î–•–û–î** (–ø—Ä–∏–º–µ–Ω—ë–Ω –≤–æ –í–°–ï–• —Å–µ—Ä–≤–∏—Å–∞—Ö):
``dockerfile
# syntax=docker/dockerfile:1.4
FROM node:20-alpine AS base
WORKDIR /app
RUN npm install -g pnpm@latest

# --- Builder stage ---
FROM base AS builder
COPY pnpm-workspace.yaml pnpm-lock.yaml ./
COPY services/<SERVICE>/package.json ./services/<SERVICE>/

# BuildKit cache mount - –ö–õ–Æ–ß–ï–í–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø!
RUN --mount=type=cache,id=pnpm,target=/root/.local/share/pnpm/store \
    pnpm install --frozen-lockfile

COPY services/<SERVICE>/src ./services/<SERVICE>/src
WORKDIR /app/services/<SERVICE>
RUN pnpm run build

# --- Production stage ---
FROM base AS production
WORKDIR /workspace/services/<SERVICE>
COPY --from=builder /app/services/<SERVICE>/package.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º prod dependencies —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
RUN --mount=type=cache,id=pnpm,target=/root/.local/share/pnpm/store \
    pnpm install --prod --frozen-lockfile

COPY --from=builder /app/services/<SERVICE>/dist ./dist
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ pnpm store** - —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–±–æ—Ä–∫–∏ –≤ 3-5 —Ä–∞–∑
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ symlinks** - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - Verdaccio –∫–µ—à–∏—Ä—É–µ—Ç npm –ø–∞–∫–µ—Ç—ã
- ‚úÖ **Production-ready** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ prod dependencies

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ**:
- [x] `services/auth-service/Dockerfile`
- [x] `services/blog-service/Dockerfile`
- [x] `infra/plugin-hub/Dockerfile`
- [x] `infra/quark-ui/Dockerfile`
- [x] `infra/quark-landing/Dockerfile`
- [x] `infra/monitoring/Dockerfile`

**–£–¥–∞–ª—ë–Ω–Ω—ã–µ —Ö–∞–∫–∏**:
- ‚ùå –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `/workspace/node_modules` —Ü–µ–ª–∏–∫–æ–º
- ‚ùå –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ symlinks —á–µ—Ä–µ–∑ find/ln
- ‚ùå `|| pnpm install` fallback –±–µ–∑ frozen-lockfile

---

### üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è Docker-–æ–±—Ä–∞–∑–æ–≤ (–û–ë–ù–û–í–õ–ï–ù–û 2025-11-06)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–ö–¢–ò–í–ù–û  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-11-06

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è **–†–∞–±–æ—á–∏–µ –æ–±—Ä–∞–∑—ã** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `quark-` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `quark-quark-ui:latest`)
- ‚ö†Ô∏è **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –æ–±—Ä–∞–∑—ã** –ø–æ–º–µ—á–∞—é—Ç—Å—è —Ç–µ–≥–æ–º `backup` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `quark_quark-ui:backup`)
- ‚ö†Ô∏è **–£–¥–∞–ª–µ–Ω—ã** –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–±—Ä–∞–∑—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `quark_` –∏ —Ç–µ–≥–æ–º `latest`

**–ù–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è**:
1. **–†–∞–±–æ—á–∏–µ –æ–±—Ä–∞–∑—ã**: `quark-<service>:<tag>`
   - –ü—Ä–∏–º–µ—Ä: `quark-quark-ui:latest`, `quark-auth-service:latest`
2. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –æ–±—Ä–∞–∑—ã**: `quark_<service>:backup`
   - –ü—Ä–∏–º–µ—Ä: `quark_quark-ui:backup`, `quark_auth-service:backup`
3. **–£–¥–∞–ª–µ–Ω–∏–µ**: –í—Å–µ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–±—Ä–∞–∑—ã `quark_<service>:latest` –±–µ–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≤ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –æ–±—Ä–∞–∑–æ–≤
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–±–æ—á–∏–º–∏ –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –æ–±—Ä–∞–∑–∞–º–∏
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞–º–∏
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—É—Ç–∞–Ω–∏—Ü—ã —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º–∏—Å—è –æ–±—Ä–∞–∑–∞–º–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- [x] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ `docker-compose.yml` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—Ä–∞–∑—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `quark-`
- [x] –°–æ–∑–¥–∞–Ω—ã —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `quark_` –∏ —Ç–µ–≥–æ–º `backup`
- [x] –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–±—Ä–∞–∑—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `quark_` –∏ —Ç–µ–≥–æ–º `latest`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∏–º–µ–Ω –æ–±—Ä–∞–∑–æ–≤

**–ü—Ä–∏–º–µ—Ä—ã**:
```
# –†–∞–±–æ—á–∏–µ –æ–±—Ä–∞–∑—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ production)
quark-quark-ui:latest
quark-auth-service:latest
quark-blog-service:latest

# –†–µ–∑–µ—Ä–≤–Ω—ã–µ –æ–±—Ä–∞–∑—ã (–¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
quark_quark-ui:backup
quark_auth-service:backup
quark_blog-service:backup
```

**–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –æ–±—Ä–∞–∑–∞
docker tag quark-quark-ui:latest quark_quark-ui:backup

# –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –æ–±—Ä–∞–∑–∞
docker rmi quark-quark-ui:latest

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
docker tag quark_quark-ui:backup quark-quark-ui:latest
```

---

## üîß MODULE SYSTEM

### ‚úÖ ES Modules (type: "module")

**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–û –≤ auth-service  
**–ü—Ä–∏—á–∏–Ω–∞**: Top-level await, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫

**TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```json
{
  "compilerOptions": {
    "module": "ES2022",
    "target": "ES2022",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true
  }
}
```

**package.json**:
```json
{
  "type": "module"
}
```

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è **–í—Å–µ –∏–º–ø–æ—Ä—Ç—ã** –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `.js`: `import { X } from "./file.js"`
- ‚ö†Ô∏è **–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç** `__dirname` –∏ `__filename` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `import.meta.url`)
- ‚ö†Ô∏è **require()** –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `createRequire` –¥–ª—è legacy –ø–∞–∫–µ—Ç–æ–≤):
  ```typescript
  import { createRequire } from "node:module";
  const require = createRequire(import.meta.url);
  const legacyPackage = require("node-vault");
  ```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```bash
# –ú–∞—Å—Å–æ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤
find src -name "*.ts" -exec sed -i "s|from '\(\..*\)'|from '\1.js'|g" {} \;
find src -name "*.ts" -exec sed -i 's|from "\(\..*\)"|from "\1.js"|g' {} \;
```

### üî• TypeORM + ES Modules: –†–µ—à–µ–Ω–∏–µ Circular Dependencies

**–ü—Ä–æ–±–ª–µ–º–∞**:  
TypeORM —Å `emitDecoratorMetadata: true` —Å–æ–∑–¥–∞—ë—Ç **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –º–µ–∂–¥—É entities:
```typescript
// ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –≤ ES Modules
import { User } from "./user.entity.js";

@ManyToOne(() => User, user => user.devices)
user!: User; // ReferenceError: Cannot access 'User' before initialization
```

**–ü—Ä–∏—á–∏–Ω–∞**: `__metadata("design:type", User)` —Ç—Ä–µ–±—É–µ—Ç –∫–ª–∞—Å—Å User **–¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è**.

**‚úÖ –†–ï–®–ï–ù–ò–ï (–ø—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ auth-service)**:

1. **String-based relations** –≤–º–µ—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏–π:
   ```typescript
   import type { User } from "./user.entity.js"; // Type-only import

   @ManyToOne("User", "devices")
   @JoinColumn({ name: "userId" })
   user!: User;
   ```

2. **Explicit entity paths** –≤ TypeOrmModule:
   ```typescript
   TypeOrmModule.forRoot({
     entities: [
       "dist/users/user.entity.js",
       "dist/users/device.entity.js",
     ],
     autoLoadEntities: false,
   })
   ```

3. **Type-only imports** –¥–ª—è TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏–∏:
   ```typescript
   import type { Device } from "./device.entity.js";
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ runtime
- ‚úÖ –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤ TypeScript
- ‚úÖ ES Modules —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—Ç–∫–∞—Ç–∞ –Ω–∞ CommonJS

### üöÄ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Drizzle ORM

**–ü–æ—á–µ–º—É Drizzle > TypeORM –¥–ª—è Quark**:
| –ö—Ä–∏—Ç–µ—Ä–∏–π | Drizzle ORM | TypeORM |
|----------|-------------|---------|
| ES Modules | ‚úÖ Native | ‚ùå –ü—Ä–æ–±–ª–µ–º—ã |
| Runtime | ‚úÖ Zero (—Ç–æ–ª—å–∫–æ AST) | ‚ùå 3 MB |
| Type safety | ‚úÖ TypeScript-native | ‚ö†Ô∏è Reflection-based |
| –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã | ‚úÖ –ù–µ –Ω—É–∂–Ω—ã | ‚ùå –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Quark | ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å, –º–∏–Ω–∏–º–∞–ª–∏–∑–º | ‚ùå –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π |

**–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏**: —Å–º. TODO #5 (–Ω–∞—á–∞—Ç—å —Å user-service)

---

## üåê NETWORKING & INFRASTRUCTURE

### üîå NATS.io –¥–ª—è Event Bus

**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–û  
**–í–µ—Ä—Å–∏—è**: NATS 2.x  
**–ü–æ—Ä—Ç**: 4222 (client), 8222 (monitoring)

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è –í—Å–µ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ NATS, –ù–ï –Ω–∞–ø—Ä—è–º—É—é
- ‚ö†Ô∏è Subject naming: `quark.<service>.<event>`
- ‚ö†Ô∏è Dead letter queue: `quark.dlq`

**ADR**: `docs/adr/adr-001-nats-vs-kafka.md`

---

### üì¶ Verdaccio - –ª–æ–∫–∞–ª—å–Ω—ã–π npm registry

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–ö–¢–ò–í–ù–û (–¥–æ–±–∞–≤–ª–µ–Ω 2025-11-05)  
**–í–µ—Ä—Å–∏—è**: Verdaccio 5  
**–ü–æ—Ä—Ç**: 4873  
**Image**: `verdaccio/verdaccio:5`  
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ npm –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `/home/odmen/quark/infra/verdaccio/conf/config.yaml`
```yaml
uplinks:
  npmjs:
    url: https://registry.npmjs.org/
    maxage: 24h
    timeout: 60s
    max_fails: 3
    fail_timeout: 10m

packages:
  '@quark/*':
    access: $all
    publish: $authenticated
    proxy: npmjs
  
  '**':
    access: $all
    proxy: npmjs

web:
  title: Quark NPM Registry
  enable: true

max_body_size: 100mb
```

**docker-compose.yml**:
```yaml
verdaccio:
  image: verdaccio/verdaccio:5
  container_name: quark-verdaccio
  ports:
    - "4873:4873"
  volumes:
    - verdaccio_storage:/verdaccio/storage
    - ./infra/verdaccio/conf:/verdaccio/conf
  networks:
    - quark-network
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞**:
```properties
# .npmrc (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
registry=http://localhost:4873/
fetch-timeout=300000
fetch-retries=5
```

**–í Dockerfile**:
```dockerfile
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Verdaccio –≤–Ω—É—Ç—Ä–∏ Docker network
ENV NPM_CONFIG_REGISTRY=http://verdaccio:4873
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (24 —á–∞—Å–∞)
- ‚úÖ –°–±–æ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã —Å–µ—Ç–µ–≤—ã–µ —Ç–∞–π–º–∞—É—Ç—ã (ETIMEDOUT from npmjs.org)
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ @quark/* –ø–∞–∫–µ—Ç—ã
- ‚úÖ Web UI –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:4873

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `/infra/verdaccio/conf/` (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
- ‚ö†Ô∏è Storage —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Docker volume `verdaccio_storage`
- ‚ö†Ô∏è –ü—Ä–∏ –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –∏–∑ npmjs.org, –∫–µ—à–∏—Ä—É–µ—Ç –Ω–∞ 24 —á–∞—Å–∞
- ‚ö†Ô∏è –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ @quark/* –ø–∞–∫–µ—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

**–•—Ä–∞–Ω–∏–ª–∏—â–µ**: `verdaccio_storage` volume (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫–µ—à–∞)

---

### üóÑÔ∏è PostgreSQL 16

**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–û  
**–ü–æ—Ä—Ç**: 5432  
**Databases**: –û—Ç–¥–µ–ª—å–Ω–∞—è –ë–î –Ω–∞ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å

```
quark_auth      - Auth Service
quark_blog      - Blog Service  
quark_messaging - Messaging Service
quark_user      - User Service
```

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è **–ú–∏–≥—Ä–∞—Ü–∏–∏**: –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–µ–π —Å—Ö–µ–º–æ–π (TypeORM/Drizzle)
- ‚ö†Ô∏è **–ù–ï –¥–µ–ª–∞—Ç—å** cross-database joins - —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ API/events

---

### üîê HashiCorp Vault

**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–û  
**–ü–æ—Ä—Ç**: 8200  
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: JWT secrets rotation, API keys

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è –°–µ–∫—Ä–µ—Ç—ã –ù–ï —Ö—Ä–∞–Ω–∏—Ç—å –≤ .env
- ‚ö†Ô∏è JWT signing keys —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üéØ ARCHITECTURE PATTERNS

### üîå –ú–ö–° Module Docking Pattern

**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–û  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: Plugin Hub (port 3000)

**–ü—Ä–∏–Ω—Ü–∏–ø**: –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ "–º–æ–¥—É–ª–∏" –≤ Plugin Hub

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å `module-manifest.yaml`
- ‚ö†Ô∏è Health check endpoint –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
- ‚ö†Ô∏è Heartbeat –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

**ADR**: `docs/adr/adr-003-module-docking.md`

---

### üîê JWT Authentication

**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–û  
**–°—Ç–∞–Ω–¥–∞—Ä—Ç**: JWT (RS256 –¥–ª—è inter-service, HS256 –¥–ª—è user tokens)

**Token Types**:
```typescript
enum TokenType {
  USER = "user",           // Frontend ‚Üí Backend
  SERVICE = "service",     // Service ‚Üí Service  
  ADMIN = "admin",         // Admin operations
  API_KEY = "api_key"      // External integrations
}
```

**–ö–†–ò–¢–ò–ß–ù–û**:
- ‚ö†Ô∏è –í—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤—ã–∑–æ–≤—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Service tokens
- ‚ö†Ô∏è Audience (`aud`) –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å target service
- ‚ö†Ô∏è Issuer (`iss`) –≤—Å–µ–≥–¥–∞ "quark-auth-service"

**ADR**: `docs/adr/adr-005-jwt-auth.md`

---

## üìä MONITORING & OBSERVABILITY

### üìà Prometheus + Grafana

**–°—Ç–∞—Ç—É—Å**: –ê–ö–¢–ò–í–ù–û  
**Prometheus**: port 9090  
**Grafana**: port 3030

**Metrics naming convention**:
```
quark_<service>_<metric>_<unit>

–ü—Ä–∏–º–µ—Ä—ã:
quark_auth_requests_total
quark_blog_posts_created_total
quark_messaging_messages_sent_total
```

---

## üöÄ CI/CD

### ‚ö†Ô∏è –ù–ï –ù–ê–°–¢–†–û–ï–ù–û (TODO)

**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è**:
- GitHub Actions –¥–ª—è CI
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
- Deployment –Ω–∞ staging/production

**–§–∞–π–ª**: `docs/ci-cd-pipeline.yml` (—à–∞–±–ª–æ–Ω –≥–æ—Ç–æ–≤)

---

## üîÑ DEPENDENCY UPDATES

### üì¶ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: Semantic Versioning 2.0.0

**–ü—Ä–∞–≤–∏–ª–∞**:
- `^` –¥–ª—è minor/patch updates (default)
- –¢–æ—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (@nestjs/*, typeorm)

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**: `pnpm outdated` (–∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ)

---

## ‚ö° PERFORMANCE

### üéØ Target Metrics

```
API Response Time: < 200ms (p95)
Database Query: < 50ms (p95)  
Event Processing: < 100ms (p95)
Docker Build: < 5 min (–±–µ–∑ cache)
```

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå Docker build auth-service: 10+ –º–∏–Ω—É—Ç (npm registry —Ç–∞–π–º–∞—É—Ç—ã)
- ‚ö†Ô∏è pnpm install –≤ production stage –º–µ–¥–ª–µ–Ω–Ω—ã–π

---

## üîß DEVELOPMENT TOOLS

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ

- **pnpm**: Package manager
- **TypeScript**: 5.x
- **ESLint**: Code quality (TODO: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
- **Prettier**: Code formatting (TODO: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)

### ‚ö†Ô∏è –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–Ω–æ –Ω—É–∂–Ω—ã)

- [ ] Husky (git hooks)
- [ ] Lint-staged
- [ ] Commitlint
- [ ] Docker Compose v2

---

## üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### Spec-Driven Development

**–ü–∞–ø–∫–∞**: `.specify/`  
**Constitution**: `.specify/memory/constitution.md`

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –°–æ–∑–¥–∞—Ç—å spec: `specs/<ID>-<name>/spec.md`
2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å plan: `specs/<ID>-<name>/plan.md`
3. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã: `specs/<ID>-<name>/contracts/`

---

## ‚ö†Ô∏è –ò–ó–í–ï–°–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### ‚úÖ –†–µ—à—ë–Ω–Ω—ã–µ (2025-11-05)

1. **Docker build –ø–∞–¥–∞–ª —Å network timeout**
   - **–ë—ã–ª–æ**: docker-compose v1 + –º–µ–¥–ª–µ–Ω–Ω—ã–π npm registry, ETIMEDOUT –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–∞–∫–µ—Ç–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ**: Docker Compose v2 + Verdaccio (–Ω–∞—Å—Ç—Ä–æ–µ–Ω 2025-11-05) + BuildKit cache
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–±–æ—Ä–∫–∞ —É—Å–∫–æ—Ä–µ–Ω–∞ –≤ 3-5 —Ä–∞–∑, —Ç–∞–π–º–∞—É—Ç—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã

2. **pnpm symlinks –ª–æ–º–∞–ª–∏—Å—å –≤ Docker**
   - **–ë—ã–ª–æ**: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ node_modules –º–µ–∂–¥—É layers
   - **–†–µ—à–µ–Ω–∏–µ**: BuildKit cache mounts + –ª–æ–∫–∞–ª—å–Ω—ã–π pnpm install
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Symlinks —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö

3. **auth-service: ES Modules + TypeORM circular dependency**
   - **–ë—ã–ª–æ**: `ReferenceError: Cannot access 'User' before initialization`
   - **–†–µ—à–µ–Ω–∏–µ**: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CommonJS (tsconfig: module ES2022‚Üícommonjs, target ES2022‚ÜíES2021)
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –°–µ—Ä–≤–∏—Å —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
   - **–î–∞—Ç–∞**: 2025-11-05

### üêõ –¢–µ–∫—É—â–∏–µ (—Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è)

1. **Dockerfile integration —Å Verdaccio**
   - **–°—Ç–∞—Ç—É—Å**: –í –ü–†–û–¶–ï–°–°–ï
   - **–ü—Ä–æ–±–ª–µ–º–∞**: Dockerfiles –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Verdaccio registry
   - **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å `ENV NPM_CONFIG_REGISTRY=http://verdaccio:4873` –≤ Dockerfiles
   - **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –û–±–Ω–æ–≤–∏—Ç—å auth-service, blog-service, quark-ui Dockerfiles
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í–´–°–û–ö–ò–ô - —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç Docker builds

2. **Dockerfile optimization: --frozen-lockfile –≤ production**
   - **–°—Ç–∞—Ç—É—Å**: –†–µ—à–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ
   - **–ü—Ä–æ–±–ª–µ–º–∞**: pnpm-lock.yaml —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–ï –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–Ω–æ—Ä–µ–ø–æ
   - **–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞—Ç—å `--frozen-lockfile` –∏–∑ production stage, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pnpm install --prod`
   - **–†–∏—Å–∫**: –ù–∏–∑–∫–∏–π, Verdaccio –∫–µ—à–∏—Ä—É–µ—Ç –ø–∞–∫–µ—Ç—ã, –≤–µ—Ä—Å–∏–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ package.json

---

## üîÑ –ü–û–°–õ–ï–î–ù–ï–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï

**–î–∞—Ç–∞**: 2025-11-25
**–ê–≤—Ç–æ—Ä**: Development Team + –ì–ª–∞–≤–Ω—ã–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä

### –ö—Ä–∞—Ç–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (2025-11-25)

- ‚úÖ `docker-compose.yml` ‚Äî `quark-ui` –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–±–æ—Ä–∫—É —á–µ—Ä–µ–∑ `build:` (context: `.`, dockerfile: `infra/quark-ui/Dockerfile`). –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–±–æ—Ä–∫—É UI –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç `quark-manager.sh` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å `quark-ui` –∫–∞–∫ —á–∞—Å—Ç—å `ordered_build`.
- ‚úÖ `quark-manager.sh` ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
  - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ here-doc (`cat <<'JSON'`) ‚Äî —É—Å—Ç—Ä–∞–Ω—è–ª–∞ –æ—à–∏–±–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞;
  - —É–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `wait_for_health` –¥–ª—è `verdaccio`: —Ç–µ–ø–µ—Ä—å —Å–µ—Ä–≤–∏—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è healthy, –µ—Å–ª–∏ `HTTP 200` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ `http://127.0.0.1:4873`; —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∂–Ω—ã–µ fallback'—ã –ø—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ Verdaccio;
  - –¥–æ–±–∞–≤–ª–µ–Ω–∞ Verdaccio-aware –ª–æ–≥–∏–∫–∞ –≤ `check_ports`: –ø—Ä–∏ –∑–∞–Ω—è—Ç–æ–º –ø–æ—Ä—Ç—É `4873` —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç HTTP-–∫–æ–¥ (200 ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º; 404 ‚Üí –ø—ã—Ç–∞–µ–º—Å—è –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Verdaccio; –Ω–µ—É–¥–∞—á–∞ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä);
  - –ø—Ä–æ–≥—Ä–µ–≤ –∫–µ—à–∞ Verdaccio —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–µ–∫—Ç–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–µ—à–∞: `./.cache/quark-cache` (–∏–∑–±–µ–≥–∞–µ—Ç —Ö–æ—Å—Ç–æ–≤—ã—Ö /tmp —Å–æ–∫–µ—Ç–æ–≤ –∏ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏);

### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π build `quark-ui` –¥–µ–ª–∞–µ—Ç `./quark-manager.sh build` –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º: –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–±–∏—Ä–∞—Ç—å UI –ø–µ—Ä–µ–¥ –ø–æ–¥–Ω—è—Ç–∏–µ–º —Å—Ç–µ–∫–∞.
- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Verdaccio —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∏—Å–∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –≤–Ω–µ—à–Ω–∏–π —Ä–µ–µ—Å—Ç—Ä, –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π registry —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –µ–≥–æ endpoint –æ—Ç–¥–∞—ë—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `./quark-manager.sh build` / `./quark-manager.sh start` –¥–ª—è full lifecycle –Ω–∞ –¥–µ–≤/—Å—Ç–µ–Ω–¥–µ ‚Äî —Å–∫—Ä–∏–ø—Ç —Ç–µ–ø–µ—Ä—å —É–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å verdaccio/quark-ui edge-cases.
- –ü–æ-–ø—Ä–µ–∂–Ω–µ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å Dockerfiles —Å–µ—Ä–≤–∏—Å–æ–≤, —á—Ç–æ–±—ã —è–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å Verdaccio (ENV `NPM_CONFIG_REGISTRY=http://verdaccio:4873`) ‚Äî —ç—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ–π –∏ –æ—Ç–º–µ—á–µ–Ω–æ –Ω–∏–∂–µ –∫–∞–∫ TODO.


### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

#### ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ (2025-11-06)

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω–∏–ª–∏—Å—å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ docker-compose.yml

**–†–µ—à–µ–Ω–∏–µ**:
1. –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
2. –ó–∞–º–µ–Ω–µ–Ω—ã –ø—Ä—è–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ docker-compose.yml
3. –î–æ–±–∞–≤–ª–µ–Ω .env –≤ .gitignore
4. –°–æ–∑–¥–∞–Ω ADR-010 –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–µ–∫—Ä–µ—Ç–∞–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- ‚úÖ –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º DevSecOps
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–µ–∫—Ä–µ—Ç–∞–º–∏

#### ‚úÖ –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î (2025-11-06)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î —á–µ—Ä–µ–∑ raw SQL —Å–∫—Ä–∏–ø—Ç—ã –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π

**–†–µ—à–µ–Ω–∏–µ**:
1. –í–Ω–µ–¥—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
   - auth-service: TypeORM –º–∏–≥—Ä–∞—Ü–∏–∏
   - blog-service: Drizzle ORM –º–∏–≥—Ä–∞—Ü–∏–∏
2. –£–¥–∞–ª–µ–Ω init-databases.sql
3. –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
4. –°–æ–∑–¥–∞–Ω ADR-011 –ø–æ —Å–∏—Å—Ç–µ–º–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º—ã –ë–î
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥—Ö–æ–¥ –∫ –º–∏–≥—Ä–∞—Ü–∏—è–º

#### ‚úÖ –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ (2025-11-06)

**–ü—Ä–æ–±–ª–µ–º–∞**: –§–∞–π–ª—ã –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –Ω–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü–µ—Ä–µ–º–µ—â–µ–Ω—ã —Ñ–∞–π–ª—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã
3. –£–¥–∞–ª–µ–Ω—ã –Ω–µ–Ω—É–∂–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
4. –°–æ–∑–¥–∞–Ω ADR-012 –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç—É
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥—Ö–æ–¥ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞

#### ‚úÖ –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è Docker-–æ–±—Ä–∞–∑–æ–≤ (2025-11-06)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è Docker-–æ–±—Ä–∞–∑–æ–≤ –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ –ø—É—Ç–∞–Ω–∏—Ü–µ –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –æ–±—Ä–∞–∑–æ–≤

**–†–µ—à–µ–Ω–∏–µ**:
1. –í–Ω–µ–¥—Ä–µ–Ω–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤:
   - –†–∞–±–æ—á–∏–µ –æ–±—Ä–∞–∑—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `quark-` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `quark-quark-ui:latest`)
   - –†–µ–∑–µ—Ä–≤–Ω—ã–µ –æ–±—Ä–∞–∑—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è —Ç–µ–≥–æ–º `backup` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `quark_quark-ui:backup`)
2. –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–±—Ä–∞–∑—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `quark_` –∏ —Ç–µ–≥–æ–º [latest](file:///home/odmen/quark/tools/quark-manager/src/check-packages.ts#L17-L17)
3. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∏–º–µ–Ω –æ–±—Ä–∞–∑–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≤ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –æ–±—Ä–∞–∑–æ–≤
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–±–æ—á–∏–º–∏ –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –æ–±—Ä–∞–∑–∞–º–∏
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞–º–∏
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—É—Ç–∞–Ω–∏—Ü—ã —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º–∏—Å—è –æ–±—Ä–∞–∑–∞–º–∏
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –≤ [CRITICAL-CONFIG.md](file:///home/odmen/quark/docs/CRITICAL-CONFIG.md)

#### ‚úÖ Verdaccio npm registry (–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ - 2025-11-05)

**–ü—Ä–æ–±–ª–µ–º–∞**: Docker build —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏ `ETIMEDOUT request to https://registry.npmjs.org` –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ 995+ –ø–∞–∫–µ—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ**:
1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Verdaccio 5 –≤ `infra/verdaccio/`
2. –°–æ–∑–¥–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `infra/verdaccio/conf/config.yaml`:
   - Uplinks –Ω–∞ npmjs.org —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º 24 —á–∞—Å–∞
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ @quark/* scope –ø–∞–∫–µ—Ç–æ–≤
   - Web UI –Ω–∞ http://localhost:4873
3. –î–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å –≤ docker-compose.yml —Å volume mounts:
   - `verdaccio_storage:/verdaccio/storage` - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫–µ—à–∞
   - `./infra/verdaccio/conf:/verdaccio/conf` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ Verdaccio –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ port 483
- ‚úÖ Web UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Quark NPM Registry"
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ Dockerfiles
- ‚è≥ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –æ–±–Ω–æ–≤–∏—Ç—å Dockerfiles —Å `ENV NPM_CONFIG_REGISTRY=http://verdaccio:4873`

#### ‚úÖ auth-service: ES Modules ‚Üí CommonJS (2025-11-05)

**–ü—Ä–æ–±–ª–µ–º–∞**: `ReferenceError: Cannot access 'User' before initialization` - TypeORM + ES Modules –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–†–µ—à–µ–Ω–∏–µ**:
- `tsconfig.json`: `"module": "ES2022"` ‚Üí `"commonjs"`, `"target": "ES2022"` ‚Üí `"ES2021"`
- `src/main.ts`: —É–±—Ä–∞–Ω top-level await
- –£–¥–∞–ª—ë–Ω `"type": "module"` –∏–∑ package.json

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –°–µ—Ä–≤–∏—Å —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è: `pnpm run build` —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ
- ‚úÖ Vault –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (JWT secret generation)
- üìù –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å–µ–∫—Ü–∏–∏ "MODULE SYSTEM"

#### ‚úÖ –ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è Docker (–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - 2025-11-04)

**1. Docker Compose v2.30.3**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ CLI plugin –≤ `~/.docker/cli-plugins/`
- –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã: `docker-compose` ‚Üí `docker compose`
- BuildKit –≤–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö Dockerfile**
–ü—Ä–∏–º–µ–Ω—ë–Ω –µ–¥–∏–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏:

``dockerfile
# syntax=docker/dockerfile:1.4
FROM node:20-alpine AS base
WORKDIR /app
RUN npm install -g pnpm@latest

# --- Builder stage ---
FROM base AS builder
COPY pnpm-workspace.yaml pnpm-lock.yaml ./
COPY services/<SERVICE>/package.json ./services/<SERVICE>/

# BuildKit cache mount - –ö–õ–Æ–ß–ï–í–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø!
RUN --mount=type=cache,id=pnpm,target=/root/.local/share/pnpm/store \
    pnpm install --frozen-lockfile

COPY services/<SERVICE>/src ./services/<SERVICE>/src
WORKDIR /app/services/<SERVICE>
RUN pnpm run build

# --- Production stage ---
FROM base AS production
WORKDIR /workspace/services/<SERVICE>
COPY --from=builder /app/services/<SERVICE>/package.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º prod dependencies —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
RUN --mount=type=cache,id=pnpm,target=/root/.local/share/pnpm/store \
    pnpm install --prod --frozen-lockfile

COPY --from=builder /app/services/<SERVICE>/dist ./dist
```

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**:
- ‚úÖ `services/auth-service` - NestJS + CommonJS (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω 2025-11-05) + TypeScript
- ‚úÖ `services/blog-service` - Express + Drizzle ORM + TypeScript
- ‚úÖ `infra/plugin-hub` - –ú–ö–° —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª + TypeScript
- ‚úÖ `infra/quark-ui` - Vite + React + TypeScript
- ‚úÖ `infra/quark-landing` - Next.js 15 + React 19
- ‚úÖ `infra/monitoring` - Express (–±–µ–∑ build stage)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- ‚ö° auth-service build –Ω–∞ —Ö–æ—Å—Ç–µ: **1-2 —Å–µ–∫** (pnpm + tsc)
- üîí –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: Verdaccio –∫–µ—à–∏—Ä—É–µ—Ç –≤—Å–µ npm –ø–∞–∫–µ—Ç—ã
- üöÄ CI/CD –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å GitHub Actions
- üì¶ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ pnpm symlinks
- ‚ö° –°–±–æ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤: 10+ –º–∏–Ω ‚Üí **1-2 –º–∏–Ω** (—Å –∫–µ—à–µ–º)
- üîí –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–∏
- üöÄ CI/CD –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å GitHub Actions
- üì¶ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ pnpm symlinks

### –£–¥–∞–ª—ë–Ω–Ω—ã–µ workaround'—ã
- ‚ùå –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ `/workspace/node_modules`
- ‚ùå –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ symlinks —á–µ—Ä–µ–∑ `find` –∏ `ln -sf`
- ‚ùå Fallback `|| pnpm install` –±–µ–∑ frozen-lockfile
- ‚ùå –•–∞—Ä–¥–∫–æ–¥ –ø—É—Ç–µ–π –¥–ª—è drizzle-zod –≤ blog-service

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –í–´–°–û–ö–ò–ô - –æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-11-06)
- [x] **auth-service**: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CommonJS –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å TypeORM ‚úÖ
- [x] **Verdaccio**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ npm registry cache –≤ infra/ ‚úÖ
- [x] **quark-manager.sh**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è main –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ .env ‚úÖ
- [ ] **Dockerfiles**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Verdaccio registry (ENV NPM_CONFIG_REGISTRY)
- [ ] **Docker build**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏ auth-service, blog-service, quark-ui —Å Verdaccio
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD —Å DOCKER_BUILDKIT=1
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–±–æ—Ä–∫–∏ –¥–æ/–ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ pnpm v9.x (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (2025-11-04)

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏**:
- ‚úÖ auth-service: –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ **~35 —Å–µ–∫** (–±—ã–ª–æ 10+ –º–∏–Ω)
- ‚úÖ plugin-hub: –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ **~24 —Å–µ–∫** —Å –∫–µ—à–µ–º
- ‚úÖ BuildKit cache —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–±–æ—Ä–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ (CACHED)

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- ‚úÖ Docker Compose v2.30.3 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Verdaccio –∑–∞–ø—É—â–µ–Ω –∏ –∫–µ—à–∏—Ä—É–µ—Ç npm –ø–∞–∫–µ—Ç—ã (port 4873)
- ‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –Ω–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
- ‚úÖ 6 Dockerfile –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å BuildKit cache mounts
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ workaround'—ã –∏ —Ö–∞–∫–∏
- ‚úÖ pnpm symlinks —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ë–ª–æ–∫–µ—Ä—ã**:
- ‚ö†Ô∏è auth-service —Ç—Ä–µ–±—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ CommonJS (TypeORM + ES Modules –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2025-11-06)**:
- üîß **quark-manager.sh**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `main()` –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
  - –ü—Ä–æ–±–ª–µ–º–∞: –í—ã–∑–æ–≤ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π `parse_args()` –∏ `execute_command()`
  - –ü—Ä–∏—á–∏–Ω–∞: –ù–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ `check_env_file()`
  - –†–µ—à–µ–Ω–∏–µ: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–∑ git –∏—Å—Ç–æ—Ä–∏–∏
  - –£–ª—É—á—à–µ–Ω–∏—è: –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `--skip-env-check` –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏

---

## üìù CHECKLIST –î–õ–Ø –ù–û–í–û–ì–û –°–ï–†–í–ò–°–ê

- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `pnpm-workspace.yaml`
- [ ] –°–æ–∑–¥–∞—Ç—å `package.json` —Å `"type": "module"` (–µ—Å–ª–∏ ES modules)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `docker-compose.yml`
- [ ] –°–æ–∑–¥–∞—Ç—å Dockerfile —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º pnpm install
- [ ] –î–æ–±–∞–≤–∏—Ç—å `module-manifest.yaml` –¥–ª—è Plugin Hub
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å health check endpoint
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ Prometheus targets
- [ ] –°–æ–∑–¥–∞—Ç—å spec –≤ `specs/`
- [ ] –°–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è Docker-–æ–±—Ä–∞–∑–æ–≤ (`quark-<service>:<tag>` –¥–ª—è —Ä–∞–±–æ—á–∏—Ö –æ–±—Ä–∞–∑–æ–≤)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç!

---

**–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `README.md` - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `.specify/memory/constitution.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- `docs/adr/*.md` - Architecture Decision Records
- `pnpm-workspace.yaml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- `docker-compose.yml` - –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
